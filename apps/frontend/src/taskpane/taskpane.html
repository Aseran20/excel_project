<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->

<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AlgoSheet</title>

    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>

    <!-- For more information on Fluent UI, visit https://developer.microsoft.com/fluentui#/. -->
    <link rel="stylesheet"
        href="https://res-1.cdn.office.net/files/fabric-cdn-prod_20230815.002/office-ui-fabric-core/11.1.0/css/fabric.min.css" />

    <!-- Template styles -->
    <link href="taskpane.css" rel="stylesheet" type="text/css" />
</head>

<body class="ms-font-m ms-Fabric">
    <section id="sideload-msg" class="sideload-msg">
        <h2 class="ms-font-xl">Please <a target="_blank"
                href="https://learn.microsoft.com/office/dev/add-ins/testing/test-debug-office-add-ins#sideload-an-office-add-in-for-testing">sideload</a>
            your add-in to see app body.</h2>
    </section>

    <main id="app-body" style="display: none; width: 100%;">
        <!-- Tabs -->
        <div class="tabs">
            <button id="tab-inspector" class="tab-button active">üîç Inspector</button>
            <button id="tab-examples" class="tab-button">üìö Examples</button>
            <button id="tab-docs" class="tab-button">üìñ Docs</button>
            <button id="tab-debug" class="tab-button">üîß Debug</button>
        </div>

        <!-- Inspector Tab -->
        <div id="content-inspector" class="tab-content active">
            <div class="inspector-content">
                <div id="inspector-empty" class="inspector-state">
                    <p class="ms-font-m">üìå Select a cell with ALGOSHEET data to inspect</p>
                    <p class="ms-font-xs">(Works with formulas or pasted values)</p>
                </div>

                <div id="inspector-loading" class="inspector-state" style="display:none;">
                    <p class="ms-font-m">‚è≥ Analyzing cell...</p>
                </div>

                <div id="inspector-error" class="inspector-state" style="display:none;">
                    <p class="ms-font-m-red">‚ö†Ô∏è Not an ALGOSHEET result</p>
                    <button id="btn-parse-manual" class="ms-Button">üìã Try Parse as JSON</button>
                </div>

                <div id="inspector-data" style="display:none;">
                    <div class="inspector-section">
                        <h3 class="ms-font-l">üìä Results</h3>
                        <div id="inspector-results" class="inspector-results"></div>
                    </div>

                    <div class="inspector-section" id="inspector-reasoning-section" style="display:none;">
                        <h3 class="ms-font-l">üí≠ Reasoning</h3>
                        <p id="inspector-reasoning" class="inspector-text"></p>
                    </div>

                    <div class="inspector-section" id="inspector-sources-section" style="display:none;">
                        <h3 class="ms-font-l">üîó Sources</h3>
                        <div id="inspector-sources"></div>
                    </div>
                </div>

                <div id="inspector-requests" class="inspector-section" style="display:none;">
                    <h3 class="ms-font-l">‚è≥ Pending Requests</h3>
                    <div id="requests-list"></div>
                </div>
            </div>
        </div>

        <!-- Examples Tab -->
        <div id="content-examples" class="tab-content">
            <div class="guide-content">
                <h2 class="ms-font-xl">Use Cases</h2>

                <div class="example-group">
                    <h4 class="ms-font-m">üí° Simple Question</h4>
                    <code>=ALGOSHEET("What is the capital of France?")</code>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üî¢ Get a Number</h4>
                    <code>=ALGOSHEET("Revenue of Microsoft 2023", "structured", "number")</code>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üåê Web Search</h4>
                    <code>=ALGOSHEET("Latest AI news", "free", "", "web=true")</code>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üìä M&A Analysis</h4>
                    <code>=ALGOSHEET("P/E ratio of Tesla", "structured", "number", "web=true")</code>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üí∞ Company Valuation</h4>
                    <code>=ALGOSHEET("Market cap of " & A1, "structured", "number", "web=true")</code>
                    <p class="ms-font-xs">Get real-time company valuation</p>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üìà Financial Ratios</h4>
                    <code>=ALGOSHEET("P/E ratio of " & A1, "structured", "number", "web=true")</code>
                    <p class="ms-font-xs">Extract key financial metrics</p>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üéØ Sector Analysis</h4>
                    <code>=ALGOSHEET("Industry sector of " & A1, "structured", "enum(Tech,Finance,Healthcare,Other)")</code>
                    <p class="ms-font-xs">Classify companies by sector</p>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">‚ö†Ô∏è Risk Assessment</h4>
                    <code>=ALGOSHEET("List 3 risks of acquiring " & A1, "free", "", "web=true")</code>
                    <p class="ms-font-xs">Due diligence insights</p>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üîç Extract Answer</h4>
                    <code>=ALGOSHEET_PARSE(B1, "value")</code>
                    <p class="ms-font-xs">Get clean value from JSON</p>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üåê Get Sources</h4>
                    <code>=ALGOSHEET_PARSE(B1, "sources_urls")</code>
                    <p class="ms-font-xs">Extract source URLs</p>
                </div>
            </div>
        </div>

        <!-- Docs Tab -->
        <div id="content-docs" class="tab-content">
            <div class="guide-content">
                <h2 class="ms-font-xl">Reference</h2>

                <h3 class="ms-font-l">ALGOSHEET Function</h3>
                <div class="example">
                    <code>=ALGOSHEET(prompt, [mode], [schema], [options])</code>
                </div>

                <table class="params-table">
                    <tr>
                        <th>Parameter</th>
                        <th>Required</th>
                        <th>Values</th>
                    </tr>
                    <tr>
                        <td><code>prompt</code></td>
                        <td>‚úÖ Yes</td>
                        <td>Any text question</td>
                    </tr>
                    <tr>
                        <td><code>mode</code></td>
                        <td>‚ùå No</td>
                        <td>"free" (default), "structured"</td>
                    </tr>
                    <tr>
                        <td><code>schema</code></td>
                        <td>‚ùå No</td>
                        <td>"number", "boolean", "date", "enum(...)" or JSON schema</td>
                    </tr>
                    <tr>
                        <td><code>options</code></td>
                        <td>‚ùå No</td>
                        <td>JSON options e.g. <code>{"web_search": true}</code></td>
                    </tr>
                </table>

                <h3 class="ms-font-l">üöÄ Advanced Features</h3>

                <div class="example-group">
                    <h4 class="ms-font-m">üåê Force Web Search</h4>
                    <p class="ms-font-xs">Get real-time data from the web.</p>
                    <code>=ALGOSHEET("Latest stock price of MSFT", "free", "", "{""web_search"": true}")</code>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üìã Structured Data</h4>
                    <p class="ms-font-xs">Force the output to follow a specific format.</p>
                    <code>=ALGOSHEET("Extract info", "structured", "{""type"": ""object"", ""properties"": {""name"": {""type"": ""string""}}}")</code>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üß© Multi-Field Extraction</h4>
                    <p class="ms-font-xs">Extract multiple fields at once.</p>
                    <code>=ALGOSHEET("Tesla info", "structured", "multi(revenue,ceo,sector)")</code>
                </div>

                <div class="example-group">
                    <h4 class="ms-font-m">üß† Reasoning & Debugging</h4>
                    <p class="ms-font-xs">Open the <b>Inspector</b> tab to see the AI's reasoning and sources. Use the
                        <b>Debug</b> tab to monitor API calls.
                    </p>
                </div>
                <h3 class="ms-font-l">ALGOSHEET_PARSE Function</h3>
                <div class="example">
                    <code>=ALGOSHEET_PARSE(jsonText, field)</code>
                    <p class="ms-font-s">Extract specific fields from ALGOSHEET results</p>
                </div>

                <h4 class="ms-font-m">Available Fields</h4>
                <ul class="field-list">
                    <li><code>value</code> - Main answer</li>
                    <li><code>confidence</code> - Confidence (0-1)</li>
                    <li><code>sources_urls</code> - URLs (separated by ;)</li>
                    <li><code>sources_titles</code> - Titles (separated by ;)</li>
                    <li><code>sources_snippets</code> - Snippets (separated by |)</li>
                    <li><code>raw</code> - Full JSON</li>
                </ul>

                <h3 class="ms-font-l">Options</h3>
                <ul class="field-list">
                    <li><code>web=true</code> - Enable web search with sources</li>
                    <li><code>lang=French</code> - Response in French (or any language)</li>
                </ul>

                <div class="help-box">
                    <p class="ms-font-s"><strong>üìÑ Full Documentation</strong></p>
                    <p class="ms-font-xs">See: <code>data/AlgoSheet_User_Guide.md</code></p>
                </div>
            </div>
        </div>

        <!-- Debug Tab -->
        <div id="content-debug" class="tab-content">
            <div class="debug-content">
                <h2 class="ms-font-xl">üêõ Debug Console</h2>

                <!-- Live Console -->
                <div class="debug-section">
                    <div class="debug-header">
                        <h3 class="ms-font-m">üìù Live Logs</h3>
                        <button id="btn-clear-logs" class="ms-Button ms-Button--small">Clear</button>
                    </div>
                    <div id="live-console" class="debug-console"></div>
                </div>

                <!-- Request History -->
                <div class="debug-section">
                    <div class="debug-header">
                        <h3 class="ms-font-m">üìú Request History (Last 10)</h3>
                        <button id="btn-clear-history" class="ms-Button ms-Button--small">Clear</button>
                    </div>
                    <div id="request-history" class="request-history"></div>
                </div>

                <!-- Connection Test -->
                <div class="debug-section">
                    <h3 class="ms-font-m">üîå Connection Test</h3>
                    <button id="test-backend" class="ms-Button">Test Backend API</button>
                    <div id="test-result" class="test-result"></div>
                </div>

                <!-- Queue Status Panel -->
                <div class="debug-section">
                    <h3 class="ms-font-m">üìä Queue Status</h3>

                    <!-- Statistics Grid -->
                    <div class="queue-stats">
                        <div class="stat-row">
                            <div class="stat-item">
                                <div class="stat-label">Total</div>
                                <div id="queue-total" class="stat-value">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">In Progress</div>
                                <div id="queue-in-progress" class="stat-value stat-in-progress">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Completed</div>
                                <div id="queue-completed" class="stat-value stat-success">0</div>
                            </div>
                        </div>
                        <div class="stat-row">
                            <div class="stat-item">
                                <div class="stat-label">Failed</div>
                                <div id="queue-failed" class="stat-value stat-error">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Queued</div>
                                <div id="queue-queued" class="stat-value">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Speed</div>
                                <div id="concurrency-display" class="stat-value">5</div>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="progress-bar-container">
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                        </div>
                        <div id="progress-text" class="progress-text">0 / 0 completed (0%)</div>
                    </div>

                    <!-- Speed Control -->
                    <div class="speed-control">
                        <label for="concurrency-slider" class="ms-font-s">
                            <strong>Request Speed:</strong>
                        </label>
                        <div class="slider-container">
                            <span class="slider-label">Slow</span>
                            <input type="range" id="concurrency-slider" min="1" max="10" value="5" />
                            <span class="slider-label">Fast</span>
                        </div>
                        <div class="slider-value">
                            <span id="concurrency-value">5</span> concurrent requests
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="queue-actions">
                        <button id="retry-failed-btn" class="ms-Button ms-Button--small">üîÑ Retry Failed</button>
                        <button id="clear-completed-btn" class="ms-Button ms-Button--small">üóëÔ∏è Clear Completed</button>
                    </div>

                    <!-- Request Details (collapsible) -->
                    <details class="queue-details-section">
                        <summary class="ms-font-s">
                            <strong>Request Details</strong> (<span id="details-count">0</span>)
                        </summary>
                        <div id="queue-details" class="queue-details-list"></div>
                    </details>
                </div>
            </div>
        </div>
    </main>
</body>

</html>